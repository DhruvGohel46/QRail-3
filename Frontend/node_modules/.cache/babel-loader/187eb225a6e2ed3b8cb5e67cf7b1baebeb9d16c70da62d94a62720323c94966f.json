{"ast":null,"code":"import React,{useState,useEffect,useRef,useCallback}from'react';import api from'../../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const QRScanner=_ref=>{let{isOpen,onClose,onScanComplete}=_ref;const[scanning,setScanning]=useState(false);const[error,setError]=useState('');const videoRef=useRef(null);const canvasRef=useRef(null);const streamRef=useRef(null);const scanIntervalRef=useRef(null);const isScanningRef=useRef(false);const frameCountRef=useRef(0);const onScanCompleteRef=useRef(onScanComplete);// Keep callback ref updated\nuseEffect(()=>{onScanCompleteRef.current=onScanComplete;},[onScanComplete]);const stopScanner=useCallback(async()=>{isScanningRef.current=false;// Clear scanning interval\nif(scanIntervalRef.current){clearInterval(scanIntervalRef.current);scanIntervalRef.current=null;}// Stop camera stream\nif(streamRef.current){streamRef.current.getTracks().forEach(track=>track.stop());streamRef.current=null;}setScanning(false);},[]);const captureAndScanFrame=useCallback(async()=>{if(!isScanningRef.current||!videoRef.current||!canvasRef.current){return;}try{const video=videoRef.current;const canvas=canvasRef.current;const ctx=canvas.getContext('2d');// Set canvas dimensions to match video\ncanvas.width=video.videoWidth;canvas.height=video.videoHeight;// Draw video frame to canvas\nctx.drawImage(video,0,0,canvas.width,canvas.height);// Convert canvas to base64 image\nconst imageData=canvas.toDataURL('image/jpeg',0.8);frameCountRef.current+=1;// Send frame to backend for QR scanning\ntry{const result=await api.qr.scanFromFrame(imageData);// If success with valid asset data, stop scanning and trigger callback\nif(result.success&&result.assetId&&result.asset){console.log('QR code detected with asset:',result.assetId);// Immediately stop scanning and clear interval\nisScanningRef.current=false;if(scanIntervalRef.current){clearInterval(scanIntervalRef.current);scanIntervalRef.current=null;}// Stop camera\nif(streamRef.current){streamRef.current.getTracks().forEach(track=>track.stop());streamRef.current=null;}setScanning(false);// Call the completion handler with the asset data\nif(onScanCompleteRef.current){onScanCompleteRef.current(result.assetId);}return true;}// Handle specific error cases\nif(result.error===\"Asset not found\"){console.log('QR detected but asset not found');setError(\"QR code scanned but asset not found in database\");await stopScanner();return false;}// If no QR detected, continue scanning\nreturn false;}catch(err){var _err$message;console.error('QR scan error:',err);if((_err$message=err.message)!==null&&_err$message!==void 0&&_err$message.includes('404')){setError(\"Invalid QR code: Asset not found\");await stopScanner();return false;}// Other errors - continue scanning\nreturn false;}}catch(err){// Log error but continue scanning\nif(frameCountRef.current%30===0){// Only log every 30 frames to avoid spam\nconsole.debug('Scan error:',err.message);}}},[stopScanner]);const startScanner=useCallback(async()=>{if(isScanningRef.current){return;// Already scanning\n}try{setError('');setScanning(true);isScanningRef.current=true;frameCountRef.current=0;// Request camera access\nconst stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment',// Use back camera\nwidth:{ideal:1280},height:{ideal:720}}});streamRef.current=stream;// Set video source\nif(videoRef.current){videoRef.current.srcObject=stream;videoRef.current.play();// Wait for video to be ready\nawait new Promise(resolve=>{if(videoRef.current.readyState>=2){resolve();}else{videoRef.current.addEventListener('loadedmetadata',resolve,{once:true});}});// Start continuous scanning loop\n// Scan every 200ms (5 frames per second) to balance performance and responsiveness\nscanIntervalRef.current=setInterval(()=>{if(isScanningRef.current){captureAndScanFrame();}},200);}}catch(err){console.error('Scanner error:',err);setError('Failed to start camera. Please check permissions and ensure camera is available. Error: '+err.message);setScanning(false);isScanningRef.current=false;// Clean up on error\nif(streamRef.current){streamRef.current.getTracks().forEach(track=>track.stop());streamRef.current=null;}}},[captureAndScanFrame]);useEffect(()=>{if(isOpen){// Small delay to ensure DOM is ready\nconst timer=setTimeout(()=>{startScanner();},300);return()=>{clearTimeout(timer);stopScanner();};}else{stopScanner();}},[isOpen,startScanner,stopScanner]);if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"modal show\",onClick:onClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Scan QR Code\"}),/*#__PURE__*/_jsx(\"button\",{className:\"close-btn\",onClick:onClose,children:/*#__PURE__*/_jsx(\"span\",{className:\"material-icons-round\",children:\"close\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-body\",children:/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative',width:'100%',maxWidth:'500px',margin:'0 auto'},children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,playsInline:true,muted:true,style:{width:'100%',height:'auto',borderRadius:'12px',backgroundColor:'#000',display:scanning&&!error?'block':'none'}}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,style:{display:'none'}}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",style:{marginTop:16,color:'#f44336',padding:'12px',background:'#ffebee',borderRadius:'8px'},children:[/*#__PURE__*/_jsx(\"span\",{className:\"material-icons-round\",style:{verticalAlign:'middle',marginRight:'8px'},children:\"error_outline\"}),error]}),scanning&&!error&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:16,textAlign:'center',color:'#666',display:'flex',alignItems:'center',justifyContent:'center',gap:'8px',padding:'12px',background:'#E3F2FD',borderRadius:'8px'},children:[/*#__PURE__*/_jsx(\"span\",{className:\"material-icons-round\",style:{animation:'pulse 2s infinite',color:'#1976D2'},children:\"qr_code_scanner\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Position QR code within the frame\"})]}),!scanning&&!error&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:16,textAlign:'center',color:'#666',padding:'40px',background:'#F5F5F5',borderRadius:'12px'},children:[/*#__PURE__*/_jsx(\"span\",{className:\"material-icons-round\",style:{fontSize:'48px',color:'#999',marginBottom:'12px'},children:\"camera_alt\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Initializing camera...\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-actions\",children:/*#__PURE__*/_jsx(\"button\",{className:\"md-button outline\",onClick:onClose,children:\"Cancel\"})})]})});};export default QRScanner;","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","api","jsx","_jsx","jsxs","_jsxs","QRScanner","_ref","isOpen","onClose","onScanComplete","scanning","setScanning","error","setError","videoRef","canvasRef","streamRef","scanIntervalRef","isScanningRef","frameCountRef","onScanCompleteRef","current","stopScanner","clearInterval","getTracks","forEach","track","stop","captureAndScanFrame","video","canvas","ctx","getContext","width","videoWidth","height","videoHeight","drawImage","imageData","toDataURL","result","qr","scanFromFrame","success","assetId","asset","console","log","err","_err$message","message","includes","debug","startScanner","stream","navigator","mediaDevices","getUserMedia","facingMode","ideal","srcObject","play","Promise","resolve","readyState","addEventListener","once","setInterval","timer","setTimeout","clearTimeout","className","onClick","children","e","stopPropagation","style","position","maxWidth","margin","ref","autoPlay","playsInline","muted","borderRadius","backgroundColor","display","marginTop","color","padding","background","verticalAlign","marginRight","textAlign","alignItems","justifyContent","gap","animation","fontSize","marginBottom"],"sources":["C:/QRail/Frontend/src/components/Maintenance/QRScanner.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport api from '../../services/api';\r\n\r\nconst QRScanner = ({ isOpen, onClose, onScanComplete }) => {\r\n  const [scanning, setScanning] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const streamRef = useRef(null);\r\n  const scanIntervalRef = useRef(null);\r\n  const isScanningRef = useRef(false);\r\n  const frameCountRef = useRef(0);\r\n  const onScanCompleteRef = useRef(onScanComplete);\r\n\r\n  // Keep callback ref updated\r\n  useEffect(() => {\r\n    onScanCompleteRef.current = onScanComplete;\r\n  }, [onScanComplete]);\r\n\r\n  const stopScanner = useCallback(async () => {\r\n    isScanningRef.current = false;\r\n    \r\n    // Clear scanning interval\r\n    if (scanIntervalRef.current) {\r\n      clearInterval(scanIntervalRef.current);\r\n      scanIntervalRef.current = null;\r\n    }\r\n\r\n    // Stop camera stream\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach(track => track.stop());\r\n      streamRef.current = null;\r\n    }\r\n\r\n    setScanning(false);\r\n  }, []);\r\n\r\n  const captureAndScanFrame = useCallback(async () => {\r\n    if (!isScanningRef.current || !videoRef.current || !canvasRef.current) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const video = videoRef.current;\r\n      const canvas = canvasRef.current;\r\n      const ctx = canvas.getContext('2d');\r\n\r\n      // Set canvas dimensions to match video\r\n      canvas.width = video.videoWidth;\r\n      canvas.height = video.videoHeight;\r\n\r\n      // Draw video frame to canvas\r\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n      // Convert canvas to base64 image\r\n      const imageData = canvas.toDataURL('image/jpeg', 0.8);\r\n      \r\n      frameCountRef.current += 1;\r\n\r\n      // Send frame to backend for QR scanning\r\n      try {\r\n        const result = await api.qr.scanFromFrame(imageData);\r\n\r\n        // If success with valid asset data, stop scanning and trigger callback\r\n        if (result.success && result.assetId && result.asset) {\r\n          console.log('QR code detected with asset:', result.assetId);\r\n          \r\n          // Immediately stop scanning and clear interval\r\n          isScanningRef.current = false;\r\n          if (scanIntervalRef.current) {\r\n            clearInterval(scanIntervalRef.current);\r\n            scanIntervalRef.current = null;\r\n          }\r\n          \r\n          // Stop camera\r\n          if (streamRef.current) {\r\n            streamRef.current.getTracks().forEach(track => track.stop());\r\n            streamRef.current = null;\r\n          }\r\n          \r\n          setScanning(false);\r\n          \r\n          // Call the completion handler with the asset data\r\n          if (onScanCompleteRef.current) {\r\n            onScanCompleteRef.current(result.assetId);\r\n          }\r\n          \r\n          return true;\r\n        }\r\n        \r\n        // Handle specific error cases\r\n        if (result.error === \"Asset not found\") {\r\n          console.log('QR detected but asset not found');\r\n          setError(\"QR code scanned but asset not found in database\");\r\n          await stopScanner();\r\n          return false;\r\n        }\r\n        \r\n        // If no QR detected, continue scanning\r\n        return false;\r\n        \r\n      } catch (err) {\r\n        console.error('QR scan error:', err);\r\n        if (err.message?.includes('404')) {\r\n          setError(\"Invalid QR code: Asset not found\");\r\n          await stopScanner();\r\n          return false;\r\n        }\r\n        // Other errors - continue scanning\r\n        return false;\r\n      }\r\n      \r\n    } catch (err) {\r\n      // Log error but continue scanning\r\n      if (frameCountRef.current % 30 === 0) { // Only log every 30 frames to avoid spam\r\n        console.debug('Scan error:', err.message);\r\n      }\r\n    }\r\n  }, [stopScanner]);\r\n\r\n  const startScanner = useCallback(async () => {\r\n    if (isScanningRef.current) {\r\n      return; // Already scanning\r\n    }\r\n\r\n    try {\r\n      setError('');\r\n      setScanning(true);\r\n      isScanningRef.current = true;\r\n      frameCountRef.current = 0;\r\n\r\n      // Request camera access\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: {\r\n          facingMode: 'environment', // Use back camera\r\n          width: { ideal: 1280 },\r\n          height: { ideal: 720 }\r\n        }\r\n      });\r\n\r\n      streamRef.current = stream;\r\n\r\n      // Set video source\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        videoRef.current.play();\r\n\r\n        // Wait for video to be ready\r\n        await new Promise((resolve) => {\r\n          if (videoRef.current.readyState >= 2) {\r\n            resolve();\r\n          } else {\r\n            videoRef.current.addEventListener('loadedmetadata', resolve, { once: true });\r\n          }\r\n        });\r\n\r\n        // Start continuous scanning loop\r\n        // Scan every 200ms (5 frames per second) to balance performance and responsiveness\r\n        scanIntervalRef.current = setInterval(() => {\r\n          if (isScanningRef.current) {\r\n            captureAndScanFrame();\r\n          }\r\n        }, 200);\r\n      }\r\n\r\n    } catch (err) {\r\n      console.error('Scanner error:', err);\r\n      setError('Failed to start camera. Please check permissions and ensure camera is available. Error: ' + err.message);\r\n      setScanning(false);\r\n      isScanningRef.current = false;\r\n      \r\n      // Clean up on error\r\n      if (streamRef.current) {\r\n        streamRef.current.getTracks().forEach(track => track.stop());\r\n        streamRef.current = null;\r\n      }\r\n    }\r\n  }, [captureAndScanFrame]);\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      // Small delay to ensure DOM is ready\r\n      const timer = setTimeout(() => {\r\n        startScanner();\r\n      }, 300);\r\n      \r\n      return () => {\r\n        clearTimeout(timer);\r\n        stopScanner();\r\n      };\r\n    } else {\r\n      stopScanner();\r\n    }\r\n  }, [isOpen, startScanner, stopScanner]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"modal show\" onClick={onClose}>\r\n      <div className=\"modal-content\" onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header\">\r\n          <h3>Scan QR Code</h3>\r\n          <button className=\"close-btn\" onClick={onClose}>\r\n            <span className=\"material-icons-round\">close</span>\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"modal-body\">\r\n          <div style={{ position: 'relative', width: '100%', maxWidth: '500px', margin: '0 auto' }}>\r\n            {/* Video element for camera feed */}\r\n            <video\r\n              ref={videoRef}\r\n              autoPlay\r\n              playsInline\r\n              muted\r\n              style={{\r\n                width: '100%',\r\n                height: 'auto',\r\n                borderRadius: '12px',\r\n                backgroundColor: '#000',\r\n                display: scanning && !error ? 'block' : 'none'\r\n              }}\r\n            />\r\n            \r\n            {/* Hidden canvas for frame capture */}\r\n            <canvas\r\n              ref={canvasRef}\r\n              style={{ display: 'none' }}\r\n            />\r\n\r\n            {/* Loading/Error states */}\r\n            {error && (\r\n              <div className=\"error-message\" style={{ marginTop: 16, color: '#f44336', padding: '12px', background: '#ffebee', borderRadius: '8px' }}>\r\n                <span className=\"material-icons-round\" style={{ verticalAlign: 'middle', marginRight: '8px' }}>error_outline</span>\r\n                {error}\r\n              </div>\r\n            )}\r\n            \r\n            {scanning && !error && (\r\n              <div style={{ \r\n                marginTop: 16, \r\n                textAlign: 'center', \r\n                color: '#666', \r\n                display: 'flex', \r\n                alignItems: 'center', \r\n                justifyContent: 'center', \r\n                gap: '8px',\r\n                padding: '12px',\r\n                background: '#E3F2FD',\r\n                borderRadius: '8px'\r\n              }}>\r\n                <span className=\"material-icons-round\" style={{ animation: 'pulse 2s infinite', color: '#1976D2' }}>qr_code_scanner</span>\r\n                <span>Position QR code within the frame</span>\r\n              </div>\r\n            )}\r\n            \r\n            {!scanning && !error && (\r\n              <div style={{ \r\n                marginTop: 16, \r\n                textAlign: 'center', \r\n                color: '#666',\r\n                padding: '40px',\r\n                background: '#F5F5F5',\r\n                borderRadius: '12px'\r\n              }}>\r\n                <span className=\"material-icons-round\" style={{ fontSize: '48px', color: '#999', marginBottom: '12px' }}>camera_alt</span>\r\n                <p>Initializing camera...</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"modal-actions\">\r\n          <button className=\"md-button outline\" onClick={onClose}>\r\n            Cancel\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QRScanner;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}